{
    "$schema": "https://schema.management.azure.com/schemas/2021-09-09/uiFormDefinition.schema.json",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "Zero Trust Imaging",
            "steps": [
                {
                    "name": "basics",
                    "label": "Basics",
                    "elements": [
                        {
                            "name": "scope",
                            "type": "Microsoft.Common.ResourceScope",
                            "location": {
                                "resourceTypes": []
                            },
                            "resourceTypeMetadata": []
                        }
                    ]
                },
                {
                    "name": "info",
                    "label": "Zero Trust Image Resources",
                    "elements": [
                        {
                            "name": "infoPreReq",
                            "type": "Microsoft.Common.InfoBox",
                            "options": {
                                "text": "Prior to deployment, make sure you meet the prerequisites outlined in the resource pre-reqs section in Zero Trust Image solution documentation:",
                                "uri": "https://github.com/mikedzikowski/ZTAImage#prequisites",
                                "icon": "Warning"
                            }
                        },
                        {
                            "name": "resources",
                            "type": "Microsoft.Common.Section",
                            "label": "Existing Resources",
                            "elements": [
                                {
                                    "name": "ResourceGroupsApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').scope.subscription.id, '/resourceGroups?api-version=2021-04-01')]"
                                    }
                                },
                                {
                                    "name": "resourceGroup",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Deployment Resource Group",
                                    "multiselect": false,
                                    "defaultValue": "",
                                    "toolTip": "Select the name of the existing resource group where the image will be created. Recommended to use the same resource group where the compute gallery resides.",
                                    "filterPlaceholder": "",
                                    "defaultDescription": "",
                                    "constraints": {
                                        "allowedValues": "[map(steps('info').resources.ResourceGroupsApi.value, (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
                                        "required": true
                                    },
                                    "infoMessages": [],
                                    "visible": true
                                },
                                {
                                    "name": "storageSelector",
                                    "type": "Microsoft.Solutions.ResourceSelector",
                                    "label": "Select storage account",
                                    "resourceType": "Microsoft.Storage/storageAccounts",
                                    "options": {
                                        "filter": {
                                            "subscription": "onBasics",
                                            "location": "onBasics"
                                        }
                                    }
                                },
                                {
                                    "name": "containerApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('info').resources.storageSelector.id, '/blobServices/default/containers?api-version=2023-01-01')]"
                                    }
                                },
                                {
                                    "name": "container",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "label": "Container",
                                    "defaultValue": "",
                                    "toolTip": "Select an existing container.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": "[map(steps('info').resources.containerApi.value, (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\"}')))]"
                                    }
                                }
                            ]
                        },
                        {
                            "name": "managedIdentity",
                            "type": "Microsoft.Solutions.ResourceSelector",
                            "label": "Select user assigned identity",
                            "resourceType": "Microsoft.ManagedIdentity/userAssignedIdentities",
                            "options": {
                                "filter": {
                                    "subscription": "onBasics",
                                    "location": "onBasics"
                                }
                            }
                        },
                        {
                            "name": "network",
                            "type": "Microsoft.Common.Section",
                            "label": "Network",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "virtualNetworksApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').scope.subscription.id, '/providers/Microsoft.Network/virtualNetworks?api-version=2022-11-01')]"
                                    }
                                },
                                {
                                    "name": "virtualNetwork",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "label": "Virtual Network",
                                    "defaultValue": "",
                                    "toolTip": "Select an existing virtual network for image capture.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": "[map(filter(steps('info').network.virtualNetworksApi.value, (item) => equals(item.location, steps('basics').scope.location.name)), (item) => parse(concat('{\"label\":\"', item.name, '\",\"description\":\"Resource group: ', first(skip(split(item.id, '/'), 4)), '\",\"value\":\"', item.id, '\"}')))]"
                                    }
                                },
                                {
                                    "name": "subnetsApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('info').network.virtualNetwork, '/subnets?api-version=2022-05-01')]"
                                    }
                                },
                                {
                                    "name": "subnet",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "label": "Subnet",
                                    "defaultValue": "",
                                    "toolTip": "Select an existing subnet for the image capture.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": "[map(steps('info').network.subnetsApi.value, (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\"}')))]"
                                    }
                                }
                            ]
                        },
                        {
                            "name": "gallery",
                            "type": "Microsoft.Solutions.ResourceSelector",
                            "label": "Select compute gallery",
                            "resourceType": "Microsoft.Compute/galleries",
                            "options": {
                                "filter": {
                                    "subscription": "onBasics",
                                    "location": "onBasics"
                                }
                            }
                        },
                        {
                            "name": "TenantType",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Tenant Type",
                            "placeholder": "",
                            "defaultValue": [],
                            "toolTip": "Multiple values can be selected",
                            "multiselect": false,
                            "selectAll": true,
                            "filter": true,
                            "filterPlaceholder": "Filter items ...",
                            "multiLine": false,
                            "defaultDescription": "Select your Azure Tenant type",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Commercial",
                                        "description": "Azure Commercial Tenant Type",
                                        "value": "Commercial"
                                    },
                                    {
                                        "label": "DepartmentOfDefense",
                                        "description": "Azure DepartmentOfDefense Tenant Type",
                                        "value": "DepartmentOfDefense"
                                    },
                                    {
                                        "label": "GovernmentCommunityCloud",
                                        "description": "Azure GovernmentCommunityCloud Tenant Type",
                                        "value": "GovernmentCommunityCloud"
                                    },
                                    {
                                        "label": "GovernmentCommunityCloudHigh",
                                        "description": "Azure GovernmentCommunityCloudHigh Tenant Type",
                                        "value": "GovernmentCommunityCloudHigh"
                                    }
                                ],
                                "required": true
                            },
                            "visible": true
                        },
                        {
                            "name": "image",
                            "type": "Microsoft.Common.Section",
                            "label": "Image",
                            "elements": [
                                {
                                    "name": "excludeFromLatest",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Exclude Image From Latest",
                                    "defaultValue": "false",
                                    "toolTip": "Exclude Image From Latest",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "true",
                                                "value": "true"
                                            },
                                            {
                                                "label": "false",
                                                "value": "false"
                                            }
                                        ],
                                        "required": true
                                    },
                                    "visible": true
                                },
                                {
                                    "name": "name",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Image Name",
                                    "defaultValue": "",
                                    "placeholder": "Example: developerImage"
                                },
                                {
                                    "name": "majorVersion",
                                    "type": "Microsoft.Common.Slider",
                                    "min": 1,
                                    "max": 12,
                                    "label": "Image Major Version. The minor and patch versions will be auto generated.",
                                    "subLabel": "Maj. Version",
                                    "defaultValue": 1,
                                    "showStepMarkers": false,
                                    "toolTip": "Pick the size in MB",
                                    "constraints": {
                                        "required": false
                                    },
                                    "visible": true,
                                    "required": true
                                },
                                {
                                    "name": "minorVersion",
                                    "type": "Microsoft.Common.Slider",
                                    "min": 1,
                                    "max": 12,
                                    "label": "Image Patch Version. The minor version will be auto generated.",
                                    "subLabel": "Patch Version",
                                    "defaultValue": 1,
                                    "showStepMarkers": false,
                                    "toolTip": "Pick the size in MB",
                                    "constraints": {
                                        "required": false
                                    },
                                    "visible": true,
                                    "required": true
                                },
                                {
                                    "name": "offer",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Offer",
                                    "defaultValue": "Windows 11",
                                    "toolTip": "Select the desired marketplace image offer.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Office 365",
                                                "value": "office-365"
                                            },
                                            {
                                                "label": "Windows 10",
                                                "value": "Windows-10"
                                            },
                                            {
                                                "label": "Windows 11",
                                                "value": "windows-11"
                                            }
                                        ],
                                        "required": true
                                    }
                                },
                                {
                                    "name": "skuApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').scope.subscription.id, '/providers/Microsoft.Compute/locations/', steps('basics').scope.location.name, '/publishers/MicrosoftWindowsDesktop/artifacttypes/vmimage/offers/', steps('info').image.offer, '/skus?api-version=2022-08-01')]"
                                    }
                                },
                                {
                                    "name": "sku",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "SKU",
                                    "defaultValue": "win11-22h2-avd",
                                    "toolTip": "Select the desired marketplace image SKU.",
                                    "constraints": {
                                        "allowedValues": "[map(steps('info').image.skuApi, (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "publisher",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Image Publisher",
                                    "defaultValue": "MicrosoftWindowsDesktop",
                                    "placeholder": "Example: MicrosoftWindowsDesktop",
                                    "visible": true,
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "replicaCount",
                                    "type": "Microsoft.Common.Slider",
                                    "min": 1,
                                    "max": 50,
                                    "label": "Replica count",
                                    "subLabel": "count",
                                    "defaultValue": 1,
                                    "showStepMarkers": false,
                                    "toolTip": "Regional replica count which specifies the number of replicas you want to create per region",
                                    "constraints": {
                                        "required": false
                                    },
                                    "visible": true
                                },
                                {
                                    "name": "vmSizesApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').scope.subscription.id, '/providers/Microsoft.Compute/locations/', steps('basics').scope.location.name, '/vmSizes?api-version=2023-03-01')]"
                                    }
                                },
                                {
                                    "name": "vmSize",
                                    "type": "Microsoft.Compute.SizeSelector",
                                    "label": "Virtual Machine Size",
                                    "toolTip": "",
                                    "recommendedSizes": [
                                        "Standard_D4_v4"
                                    ],
                                    "constraints": {},
                                    "options": {
                                        "hideDiskTypeFilter": false
                                    },
                                    "osPlatform": "Windows",
                                    "visible": true
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "customizations",
                    "type": "Microsoft.Common.Section",
                    "label": "Customizations",
                    "visible": true,
                    "elements": [
                        {
                            "name": "customSoftware",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "customSoftware",
                            "defaultValue": [
                                "No"
                            ],
                            "toolTip": "Select True to add custom software to the image",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes",
                                        "value": true
                                    },
                                    {
                                        "label": "No",
                                        "value": false
                                    }
                                ],
                                "required": true
                            },
                            "visible": true
                        },
                        {
                            "name": "customizations",
                            "type": "Microsoft.Common.EditableGrid",
                            "ariaLabel": "Customizations",
                            "label": "Customizations",
                            "visible": "[steps('customizations').customSoftware]",
                            "constraints": {
                                "width": "Full",
                                "rows": {
                                    "count": {
                                        "min": 0,
                                        "max": 10
                                    }
                                },
                                "columns": [
                                    {
                                        "id": "name",
                                        "header": "Name",
                                        "width": "1fr",
                                        "element": {
                                            "type": "Microsoft.Common.TextBox",
                                            "placeholder": "Example: vscode",
                                            "constraints": {
                                                "required": true,
                                                "validations": []
                                            }
                                        }
                                    },
                                    {
                                        "id": "blobname",
                                        "header": "Blobname",
                                        "width": "10fr",
                                        "element": {
                                            "type": "Microsoft.Common.TextBox",
                                            "placeholder": "Example: VSCodeSetup-x64-1.81.1.exe",
                                            "constraints": {
                                                "allowedValues": [
                                                    {
                                                        "label": "blobname",
                                                        "value": "text"
                                                    }
                                                ],
                                                "required": true
                                            }
                                        }
                                    },
                                    {
                                        "id": "arguments",
                                        "header": "Arguments",
                                        "width": "10fr",
                                        "element": {
                                            "type": "Microsoft.Common.TextBox",
                                            "placeholder": "Example: /silent /mergetasks='!runcode'",
                                            "constraints": {
                                                "allowedValues": [
                                                    {
                                                        "label": "Arguments",
                                                        "value": "text"
                                                    }
                                                ],
                                                "required": false 
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            "name": "office",
                            "type": "Microsoft.Common.Section",
                            "label": "Software",
                            "elements": [
                                {
                                    "name": "installOffice",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Install Office",
                                    "defaultValue": "false",
                                    "toolTip": "Select True to install Office",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "true",
                                                "value": true
                                            },
                                            {
                                                "label": "false",
                                                "value": false
                                            }
                                        ],
                                        "required": true
                                    }
                                },
                                {
                                    "name": "officeBlob",
                                    "type": "Microsoft.Storage.StorageBlobSelector",
                                    "visible": "[steps('customizations').office.installOffice]",
                                    "toolTip": "Select office blob",
                                    "label": "Office (.exe)",
                                    "options": {
                                        "text": "Select Package"
                                    },
                                    "constraints": {
                                        "allowedFileExtensions": [
                                            "exe"
                                        ]
                                    }
                                },
                                {
                                    "name": "installAccess",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "InstallAccess",
                                    "defaultValue": "false",
                                    "toolTip": "Select True to install Access",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "true",
                                                "value": true
                                            },
                                            {
                                                "label": "false",
                                                "value": false
                                            }
                                        ],
                                        "required": true
                                    },
                                    "visible": "[steps('customizations').office.installOffice]"
                                },
                                {
                                    "name": "installExcel",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "installExcel",
                                    "defaultValue": "false",
                                    "toolTip": "Select True to install Excel",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "true",
                                                "value": true
                                            },
                                            {
                                                "label": "false",
                                                "value": false
                                            }
                                        ],
                                        "required": true
                                    },
                                    "visible": "[steps('customizations').office.installOffice]"
                                },
                                {
                                    "name": "installOneDriveForBusiness",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Install One Dive For Business",
                                    "defaultValue": "false",
                                    "toolTip": "Select True to Install One Dive For Business",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "true",
                                                "value": true
                                            },
                                            {
                                                "label": "false",
                                                "value": false
                                            }
                                        ],
                                        "required": true
                                    },
                                    "visible": "[steps('customizations').office.installOffice]"
                                },
                                {
                                    "name": "installOneNote",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Install OneNote",
                                    "defaultValue": "false",
                                    "toolTip": "Select True to install OneNote",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "true",
                                                "value": true
                                            },
                                            {
                                                "label": "false",
                                                "value": false
                                            }
                                        ],
                                        "required": true
                                    },
                                    "visible": "[steps('customizations').office.installOffice]"
                                },
                                {
                                    "name": "installOutlook",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Install Outlook",
                                    "defaultValue": "false",
                                    "toolTip": "Select True to install Outlook",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "true",
                                                "value": true
                                            },
                                            {
                                                "label": "false",
                                                "value": false
                                            }
                                        ],
                                        "required": true
                                    },
                                    "visible": "[steps('customizations').office.installOffice]"
                                },
                                {
                                    "name": "installPowerPoint",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Install PowerPoint",
                                    "defaultValue": "false",
                                    "toolTip": "Select True to Install PowerPoint",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "true",
                                                "value": true
                                            },
                                            {
                                                "label": "false",
                                                "value": false
                                            }
                                        ],
                                        "required": true
                                    },
                                    "visible": "[steps('customizations').office.installOffice]"
                                },
                                {
                                    "name": "installProject",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Install Project",
                                    "defaultValue": "false",
                                    "toolTip": "Select True to install Project",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "true",
                                                "value": true
                                            },
                                            {
                                                "label": "false",
                                                "value": false
                                            }
                                        ],
                                        "required": true
                                    },
                                    "visible": "[steps('customizations').office.installOffice]"
                                },
                                {
                                    "name": "installPublisher",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Install Publisher",
                                    "defaultValue": "false",
                                    "toolTip": "Select True to install Publisher",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "true",
                                                "value": true
                                            },
                                            {
                                                "label": "false",
                                                "value": false
                                            }
                                        ],
                                        "required": true
                                    },
                                    "visible": "[steps('customizations').office.installOffice]"
                                },
                                {
                                    "name": "installSkypeForBusiness",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Install Skype For Business",
                                    "defaultValue": "false",
                                    "toolTip": "Select True to install Skype For Business",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "true",
                                                "value": true
                                            },
                                            {
                                                "label": "false",
                                                "value": false
                                            }
                                        ],
                                        "required": true
                                    },
                                    "visible": "[steps('customizations').office.installOffice]"
                                },
                                {
                                    "name": "installVisio",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "installVisio",
                                    "defaultValue": "false",
                                    "toolTip": "Select True to install Visio",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "true",
                                                "value": true
                                            },
                                            {
                                                "label": "false",
                                                "value": false
                                            }
                                        ],
                                        "required": true
                                    },
                                    "visible": "[steps('customizations').office.installOffice]"
                                },
                                {
                                    "name": "installWord",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Install Word",
                                    "defaultValue": "false",
                                    "toolTip": "Select True to install Word",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "true",
                                                "value": true
                                            },
                                            {
                                                "label": "false",
                                                "value": false
                                            }
                                        ],
                                        "required": true
                                    },
                                    "visible": "[steps('customizations').office.installOffice]"
                                },
                                {
                                    "name": "installTeams",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Install Teams",
                                    "defaultValue": "false",
                                    "toolTip": "Select True to install Teams",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "true",
                                                "value": true
                                            },
                                            {
                                                "label": "false",
                                                "value": false
                                            }
                                        ],
                                        "required": true
                                    },
                                    "visible": true
                                },
                                {
                                    "name": "teamsBlob",
                                    "type": "Microsoft.Storage.StorageBlobSelector",
                                    "visible": "[steps('customizations').office.installTeams]",
                                    "toolTip": "Select teams blob",
                                    "label": "Teams Installer (.msi)",
                                    "options": {
                                        "text": "Select Package"
                                    },
                                    "constraints": {
                                        "allowedFileExtensions": [
                                            "msi"
                                        ]
                                    }
                                },
                                {
                                    "name": "msrdcwebrtcsvcInstaller",
                                    "type": "Microsoft.Storage.StorageBlobSelector",
                                    "visible": "[steps('customizations').office.installTeams]",
                                    "toolTip": "Select Remote Desktop WebRTC Redirector Service",
                                    "label": "Remote Desktop WebRTC Redirector Service Installer (.msi)",
                                    "options": {
                                        "text": "Select Package"
                                    },
                                    "constraints": {
                                        "allowedFileExtensions": [
                                            "msi"
                                        ]
                                    }
                                },
                                {
                                    "name": "vcRedistInstaller",
                                    "type": "Microsoft.Storage.StorageBlobSelector",
                                    "visible": "[steps('customizations').office.installTeams]",
                                    "toolTip": "Select Microsoft Visual C++ Redistributable",
                                    "label": "Microsoft Visual C++ Redistributable Installer (.exe)",
                                    "options": {
                                        "text": "Select Package"
                                    },
                                    "constraints": {
                                        "allowedFileExtensions": [
                                            "exe"
                                        ]
                                    }
                                },
                                {
                                    "name": "installVirtualDesktopOptimizationTool",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Install Virtual Desktop OptimizationTool",
                                    "defaultValue": "false",
                                    "toolTip": "Select True to install Virtual Desktop OptimizationTool",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "true",
                                                "value": true
                                            },
                                            {
                                                "label": "false",
                                                "value": false
                                            }
                                        ],
                                        "required": true
                                    },
                                    "visible": true
                                },
                                {
                                    "name": "vDotBlob",
                                    "type": "Microsoft.Storage.StorageBlobSelector",
                                    "visible": "[steps('customizations').office.installVirtualDesktopOptimizationTool]",
                                    "toolTip": "Select vDot blob",
                                    "label": "VDOT Package (.zip)",
                                    "options": {
                                        "text": "Select Package"
                                    },
                                    "constraints": {
                                        "allowedFileExtensions": [
                                            "zip"
                                        ]
                                    }
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "parameters": {
                "containerName": "[first(skip(split(steps('info').resources.container, '/'), 12))]",
                "customizations": "[if(equals(steps('customizations').customSoftware, true), steps('customizations').customizations,'')]",
                "excludeFromLatest": "[steps('info').image.excludeFromLatest]",
                "galleryName": "[steps('info').gallery.name]",
                "galleryResourceGroup": "[first(skip(split(steps('info').gallery.id, '/'), 4))]",
                "imageName": "[steps('info').image.name]",
                "imageMajorVersion": "[steps('info').image.majorVersion]",
                "imageMinorVersion": "[steps('info').image.minorVersion]",
                "imageVmRg": "[steps('info').resources.resourceGroup]",
                "installAccess": "[if(equals(steps('customizations').office.installOffice, true), steps('customizations').office.installAccess,'false')]",
                "installExcel": "[if(equals(steps('customizations').office.installOffice, true), steps('customizations').office.installExcel,'false')]",
                "installOneDriveForBusiness": "[if(equals(steps('customizations').office.installOffice, true), steps('customizations').office.installOneDriveForBusiness,'false')]",
                "installOneNote": "[if(equals(steps('customizations').office.installOffice, true), steps('customizations').office.installOneNote,'false')]",
                "installOutlook": "[if(equals(steps('customizations').office.installOffice, true), steps('customizations').office.installOutlook,'false')]",
                "installPowerPoint": "[if(equals(steps('customizations').office.installOffice, true), steps('customizations').office.installPowerPoint,'false')]",
                "installProject": "[if(equals(steps('customizations').office.installOffice, true), steps('customizations').office.installProject,'false')]",
                "installPublisher": "[if(equals(steps('customizations').office.installOffice, true), steps('customizations').office.installPublisher,'false')]",
                "installSkypeForBusiness": "[if(equals(steps('customizations').office.installOffice, true), steps('customizations').office.installSkypeForBusiness,'false')]",
                "installTeams": "[steps('customizations').office.installTeams]",
                "installVirtualDesktopOptimizationTool": "[steps('customizations').office.installVirtualDesktopOptimizationTool]",
                "installVisio": "[if(equals(steps('customizations').office.installOffice, true), steps('customizations').office.installVisio,'false')]",
                "installWord": "[if(equals(steps('customizations').office.installOffice, true), steps('customizations').office.installWord,'false')]",
                "location": "[steps('basics').scope.location.name]",
                "managementVmRg": "[steps('info').resources.resourceGroup]",
                "miName": "[steps('info').managedIdentity.name]",
                "miResourceGroup": "[first(skip(split(steps('info').managedIdentity.id, '/'), 4))]",
                "offer": "[steps('info').image.offer]",
                "OsVersion": "[steps('info').image.sku]",
                "publisher": "[steps('info').image.publisher]",
                "saResourceGroup": "[first(skip(split(steps('info').resources.storageSelector.id, '/'), 4))]",
                "sku": "[steps('info').image.sku]",
                "storageAccountName": "[steps('info').resources.storageSelector.name]",
                "subnetName": "[first(skip(split(steps('info').network.subnet, '/'), 10))]",
                "TenantType": "[steps('info').TenantType]",
                "virtualNetworkName": "[first(skip(split(steps('info').network.virtualNetwork, '/'), 8))]",
                "virtualNetworkResourceGroup": "[first(skip(split(steps('info').network.virtualNetwork, '/'), 4))]",
                "vmSize": "[steps('info').image.vmSize]",
                "vDotInstaller": "[if(equals(steps('customizations').office.installVirtualDesktopOptimizationTool, true), steps('customizations').office.vDotBlob.blobName,'')]",
                "officeInstaller": "[if(equals(steps('customizations').office.installOffice, true), steps('customizations').office.officeBlob.blobName,'')]",
                "teamsInstaller": "[if(equals(steps('customizations').office.installTeams, true), steps('customizations').office.teamsBlob.blobName,'')]",
                "vcRedistInstaller": "[if(equals(steps('customizations').office.installTeams, true), steps('customizations').office.vcRedistInstaller.blobName,'')]",
                "msrdcwebrtcsvcInstaller": "[if(equals(steps('customizations').office.installTeams, true), steps('customizations').office.msrdcwebrtcsvcInstaller.blobName,'')]",
                "replicaCount": "[steps('info').image.replicaCount]"
            },
            "kind": "Subscription",
            "location": "[steps('basics').scope.location.name]",
            "subscriptionId": "[steps('basics').scope.subscription.id]"
        }
    }
}